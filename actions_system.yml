# actions_system.yml
---
- name: Exécution d'actions système sur plusieurs serveurs
  hosts: mon_groupe
  become: true   # Utilise les privilèges sudo pour les actions système
  gather_facts: false

  vars_files:
    - vault.yml  # Inclut le fichier chiffré avec Ansible Vault

  tasks:
    - name: Mettre à jour tous les paquets (RedHat/CentOS)
      ansible.builtin.yum:
        name: "*"
        state: latest
      when: ansible_os_family == "RedHat"

    - name: Mettre à jour tous les paquets (Debian/Ubuntu)
      ansible.builtin.apt:
        update_cache: yes
        upgrade: dist
      when: ansible_os_family == "Debian"

    - name: Créer un utilisateur "utilisateur_test" avec un mot de passe
      ansible.builtin.user:
        name: utilisateur_test
        password: "{{ 'mot_de_passe' | password_hash('sha512') }}"

    - name: Redémarrer le service SSH
      ansible.builtin.service:
        name: ssh
        state: restarted
